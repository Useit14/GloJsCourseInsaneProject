(()=>{"use strict";const e=e=>{for(var t=e+"=",a=document.cookie.split(";"),n=0;n<a.length;n++){for(var s=a[n];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return null},t=e=>{const t=e=>{const t=document.querySelector(".table").querySelector(".tbody");t.innerHTML="",e.length>0?e.forEach((e=>{t.innerHTML+=`\n          <tr class="table__row" data-key=${e.id}>\n          <td class="table__id table__cell">${e.id}</td>\n          <td class="table-type table__cell">${e.type}</td>\n          <td class="table-name table__cell">\n          ${e.name}\n          </td>\n          <td class="table-units table__cell">\n          ${e.units}\n          </td>\n          <td class="table-cost table__cell">\n          ${e.cost}\n          </td>\n          <td>\n              <div class="table__actions table__cell">\n                  <button class="button action-change"><span class="svg_ui"><svg class="action-icon_change"><use xlink:href="./img/sprite.svg#change"></use></svg></span><span>Изменить</span>\n                  </button>\n                  <button class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove"><use xlink:href="./img/sprite.svg#remove"></use></svg></span><span>Удалить</span>\n                  </button>\n              </div>\n          </td>\n      </tr>\n                              `})):t.innerHTML+=`\n        <tr class="table__row" data-key=${e[0].id} >\n        <td class="table__id table__cell">${e[0].id}</td>\n        <td class="table-type table__cell">${e[0].type}</td>\n        <td class="table-name table__cell">\n        ${e[0].name}\n        </td>\n        <td class="table-units table__cell">\n        ${e[0].units}\n        </td>\n        <td class="table-cost table__cell">\n        ${e[0].cost}\n        </td>\n        <td>\n            <div class="table__actions table__cell">\n                <button class="button action-change"><span class="svg_ui"><svg class="action-icon_change"><use xlink:href="./img/sprite.svg#change"></use></svg></span><span>Изменить</span>\n                </button>\n                <button class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove"><use xlink:href="./img/sprite.svg#remove"></use></svg></span><span>Удалить</span>\n                </button>\n            </div>\n        </td>\n    </tr>\n                              `};e?t(e):window.userService.getData("http://localhost:3000/items").then((e=>{t(e)}))};window.userService=new class{async getData(e,t){return await fetch(`${e}${t?"/":""}${t?.id?t?.id:""}${t?.filter?"?"+t?.filter+"="+t?.filterValue:""}${t?.sort?"?_sort="+t?.sort+"&_order="+t?.order:""}${t?.search?"?"+t?.searchParametr+"+_like="+t?.search:""}`).then((e=>e.json())).catch((e=>console.log(e)))}async sendData(e,t){return await fetch(`${e}/${t.id?t.id:""}`,{method:t.method,headers:{"Content-Type":"application/json"},body:JSON.stringify(t.body)}).then((e=>e.json())).catch((e=>console.log(e)))}},"/admin/table.html"===location.pathname?"true"===e("isAuth")?t():"/admin"!==location.pathname&&location.assign("/admin"):(async t=>{const a=document.querySelector(`#${t}`),n=document.querySelectorAll(".text-warning");a&&await a.addEventListener("submit",(e=>{e.preventDefault(),(async()=>{let e,s=!1;const{response:l,message:o}=((e,t="input")=>{const a=document.getElementById(e),n=a.querySelectorAll("input[name='name']"),s=a.querySelectorAll("input[name='email']"),l=a.querySelectorAll("input[name='phone']"),o=a.querySelectorAll("input[name='message']"),r=a.querySelectorAll("input[type='checkbox']");let c=!0,i=[],u=["+","7","(","_","_","_",")","_","_","_","-","_","_","-","_","_"];const d=e=>{e.target.value=e.target.value.replace(/[\s]{2}/gi," "),e.target.value=e.target.value.replace(/^[\s\-]|[\s\-]$/gi,""),e.target.matches('input[type="text"]')&&(e.target.value=e.target.value.replace(/([а-я]?)([а-я]+$)/gi,((e,t,a)=>t.toString().toUpperCase()+a.toString().toLowerCase())))};return n.forEach((e=>{e.addEventListener("input",(e=>{if("input"===t)return d(e),void(e.target.value=e.target.value.replace(/[^а-я\-\s]/gi,""))})),/[а-я\-\s]{2,}/gi.test(e.value)&&""!==e.value||(e.value="",i.push("Некорректное имя"),c=!1)})),s.forEach((e=>{e.addEventListener("input",(e=>{if("input"===t)return d(e),void(e.target.value=e.target.value.replace(/[^a-z\-\_\.\!\~\*\'@0-9]/gi,""))})),e.value.match(/[a-z\-\_\.\!\~\*\'0-9]+[@][a-z\-\_\!\~\*\'0-9]+[\.][a-z\-\_\!\~\*\']+/gi)&&""!==e.value||(e.value="",i.push("Некорректный почтовый ящик"),c=!1)})),l.forEach((e=>{e.addEventListener("keydown",(e=>{e.preventDefault(),(e=>{let t=!0;if(/\d/gi.test(parseInt(e.key)))u.forEach(((a,n)=>{"_"!==a&&""!==a||!t||(u[n]=e.key,t=!1)}));else if("Backspace"===e.key)if("_"===u[e.target.selectionStart-1]){for(let e=u.length-1;e>0;e--)if(/\d/gi.test(u[e])){u[e]="_";break}}else/\d/gi.test(u[e.target.selectionStart-1])&&(u[e.target.selectionStart-1]="_");e.target.value=u.join("")})(e)})),e.addEventListener("blur",(e=>{d(e)})),e.value.match(/\+7\(\d{3}\)\d{3}\-\d{2}\-\d{2}/gi)&&""!==e.value||(e.value="",i.push("Некорректный номер телефона"),c=!1)})),o.forEach((e=>{e.addEventListener("input",(e=>{e.target.value=e.target.value.replace(/[^а-я\s0-9\.\,\!\?]/gi,""),"input"!==t||d(e)})),e.value.match(/[а-я\s0-9\.\,\!\?]+/gi)&&""!==e.value||(e.value="",i.push("Некорректное сообщение"),c=!1)})),r.forEach((e=>{e.checked||(e.value="",i.push("Согласитесь с политикой конфиденциальности"),c=!1)})),{response:c,message:i}})(t,"change");if(l){const t=new FormData(a),l={};t.forEach(((e,t)=>{l[t]=e})),await window.userService.getData("http://localhost:3000/users").then((t=>{t.length>0?t.forEach((t=>{t.login===l.login?(e=t.login,s=!0):(n[0].style.opacity=1,s=!1),t.password===l.password?s=!0:(n[1].style.opacity=1,s=!1)})):(t[0].login===l.login?(e=t[0].login,s=!0):(n[0].style.opacity=1,s=!1),t[0].password===l.password?s=!0:(n[1].style.opacity=1,s=!1))}))}else n.style.opacity=1;return{login:e,isAuth:s}})().then((e=>{e.isAuth&&(((e,t)=>{let a="";{const e=new Date;e.setTime(e.getTime()+864e5),a="; expires="+e.toUTCString()}document.cookie="isAuth="+!0+a+"; path=/"})(),location.assign("./table.html"))}))})),"true"===e("isAuth")&&location.assign("./table.html")})("form-autorization"),(()=>{const e=document.querySelector("#typeItem"),a=[];let n;e&&e.addEventListener("change",(e=>{"all"!==e.target.value?window.userService.getData("http://localhost:3000/items",{filter:"type",filterValue:e.target.value}).then((e=>{t(e)})):t()})),e&&window.userService.getData("http://localhost:3000/items").then((e=>{n=e,n.length>0?e.forEach((e=>{a.includes(e.type)||a.push(e.type)})):a.push(e[0].type)})).then((()=>{e.innerHTML='<option value="all">Все услуги</option>',a.length>0?a.forEach((t=>{e.innerHTML+=`\n            <option value="${t}">${t}</option>\n            `})):n[0].type&&(e.innerHTML+=`\n            <option value="${n[0].type}">${n[0].type}</option>\n            `)}))})(),(()=>{const e=document.querySelector(".btn-addItem"),a=document.querySelector("#modalWindow");e&&e.addEventListener("click",(()=>{a.id="";const e=document.querySelector("#form-add");e.addEventListener("submit",(a=>{a.preventDefault();const n=new FormData(e),s={};n.forEach(((e,t)=>{s[t]=e})),window.userService.sendData("http://localhost:3000/items",{method:"POST",body:s}).then((()=>{t()}))})),a.addEventListener("click",(e=>{e.target.closest(".cancel-button")?e.preventDefault():e.target.closest(".button__close")&&(a.id="modalWindow")}))}))})(),(()=>{const e=document.querySelector(".tbody");if(e){const a=document.querySelector("#modalWindow"),n=document.querySelector("#form-add"),s=n.querySelector(".input__type"),l=n.querySelector(".input__name"),o=n.querySelector(".input__units"),r=n.querySelector(".input__cost"),c=a.querySelector(".modal__header");let i;e.addEventListener("click",(e=>{const u=e.target.closest("tr");e.target.closest(".action-change")&&window.userService.getData("http://localhost:3000/items",{id:u.dataset.key}).then((e=>{a.id="",c.textContent="Редактировать услугу",s.value=e.type,l.value=e.name,o.value=e.units,r.value=e.cost,i=e.id,n.addEventListener("submit",(e=>{e.preventDefault();const a=new FormData(n),s={};a.forEach(((e,t)=>{s[t]=e})),window.userService.sendData("http://localhost:3000/items",{id:i,method:"DELETE"}).then((e=>{window.userService.sendData("http://localhost:3000/items",{method:"POST",body:s}).then((()=>{t()}))}))})),a.addEventListener("click",(e=>{e.target.closest(".cancel-button")?(e.preventDefault(),s.value="",l.value="",o.value="",r.value=""):e.target.closest(".button__close")&&(c.textContent="Добавление новой услуги",s.value="",l.value="",o.value="",r.value="",a.id="modalWindow")}))}))}))}})(),(()=>{const e=document.querySelector(".tbody");e&&e.addEventListener("click",(e=>{const a=e.target.closest("tr");e.target.closest(".action-remove")&&window.userService.sendData("http://localhost:3000/items",{id:a.dataset.key,method:"DELETE"}).then((()=>{t()}))}))})(),(()=>{const e=document.querySelector("thead tr");e&&e.addEventListener("click",(e=>{if(e.target.closest(".table-th")&&!e.target.closest(".th-handler")&&!e.target.closest(".th-cost")){const a=e.target.closest(".table-th").classList[1].split("-")[1];window.userService.getData("http://localhost:3000/items",{sort:a,order:"desc"}).then((e=>{t(e)}))}}))})(),(()=>{const e=document.querySelector("#searchType"),a=document.querySelector("#searchName"),n=((e,t=300)=>{let a;return(...n)=>{a=setTimeout((()=>{clearTimeout(a),e.apply(void 0,n)}),t)}})(((e,a)=>{window.userService.getData("http://localhost:3000/items",{searchParametr:"type",search:a}).then((e=>{t(e)}))}));e&&e.addEventListener("input",(e=>{n("type",e.target.value)})),a&&a.addEventListener("input",(e=>{n("name",e.target.value)}))})()})();